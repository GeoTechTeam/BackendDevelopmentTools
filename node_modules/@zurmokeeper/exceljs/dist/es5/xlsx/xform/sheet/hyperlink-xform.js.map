{"version":3,"file":"hyperlink-xform.js","names":["BaseXform","require","HyperlinkXform","tag","render","xmlStream","model","isInternalLink","target","slice","leafNode","ref","address","tooltip","location","display","rId","parseOpen","node","name","attributes","parseText","parseClose","module","exports"],"sources":["../../../../../lib/xlsx/xform/sheet/hyperlink-xform.js"],"sourcesContent":["const BaseXform = require('../base-xform');\r\n\r\nclass HyperlinkXform extends BaseXform {\r\n  get tag() {\r\n    return 'hyperlink';\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    if (this.isInternalLink(model)) {\r\n      // Remove '#' example #sheet1!A1 -> sheet1!A1\r\n      model.target = model.target ? model.target.slice(1) : model.target;\r\n      xmlStream.leafNode('hyperlink', {\r\n        ref: model.address,\r\n        // 'r:id': model.rId, // Internal hyperlink don't need 'r:id', it's enough to have location\r\n        tooltip: model.tooltip,\r\n        location: model.target,\r\n        display: model.tooltip, // TODO: For the time being, this is compatible with google sheet. https://www.google.cn/sheets/about/\r\n      });\r\n    } else {\r\n      xmlStream.leafNode('hyperlink', {\r\n        ref: model.address,\r\n        'r:id': model.rId,\r\n        tooltip: model.tooltip,\r\n      });\r\n    }\r\n  }\r\n\r\n  parseOpen(node) {\r\n    if (node.name === 'hyperlink') {\r\n      this.model = {\r\n        address: node.attributes.ref,\r\n        rId: node.attributes['r:id'],\r\n        tooltip: node.attributes.tooltip,\r\n      };\r\n\r\n      // This is an internal link\r\n      if (node.attributes.location) {\r\n        this.model.target = node.attributes.location;\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  parseText() {}\r\n\r\n  parseClose() {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @desc example Sheet2!D3  Sheet2!D3:E3  D3:E3\r\n   * @returns\r\n   */\r\n  isInternalLink(model) {\r\n    // @example: Sheet2!D3, return true\r\n    // return model.target && /^[^!]+![a-zA-Z]+[\\d]+$/.test(model.target);\r\n\r\n    // Using regular expressions is not enough to cover all cases like the one below,\r\n    // An example of the xlsx library, which is also generic\r\n    // https://docs.sheetjs.com/docs/csf/features/hyperlinks#internal-links\r\n    // ws[\"C1\"].l = { Target: \"#SheetJSDN\", Tooltip: \"Defined Name\" };\r\n    // wb.Workbook = {\r\n    //   Names: [{Name: \"SheetJSDN\", Ref:\"Sheet2!A1:B2\"}]\r\n    // }\r\n    // an example of the xlsx library, so instead pass '#' manually to determine if it is an internal hyperlink.\r\n    return model.target && model.target.slice(0, 1) === '#';\r\n  }\r\n}\r\n\r\nmodule.exports = HyperlinkXform;\r\n"],"mappings":";;AAAA,MAAMA,SAAS,GAAGC,OAAO,CAAC,eAAe,CAAC;AAE1C,MAAMC,cAAc,SAASF,SAAS,CAAC;EACrC,IAAIG,GAAGA,CAAA,EAAG;IACR,OAAO,WAAW;EACpB;EAEAC,MAAMA,CAACC,SAAS,EAAEC,KAAK,EAAE;IACvB,IAAI,IAAI,CAACC,cAAc,CAACD,KAAK,CAAC,EAAE;MAC9B;MACAA,KAAK,CAACE,MAAM,GAAGF,KAAK,CAACE,MAAM,GAAGF,KAAK,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC,GAAGH,KAAK,CAACE,MAAM;MAClEH,SAAS,CAACK,QAAQ,CAAC,WAAW,EAAE;QAC9BC,GAAG,EAAEL,KAAK,CAACM,OAAO;QAClB;QACAC,OAAO,EAAEP,KAAK,CAACO,OAAO;QACtBC,QAAQ,EAAER,KAAK,CAACE,MAAM;QACtBO,OAAO,EAAET,KAAK,CAACO,OAAO,CAAE;MAC1B,CAAC,CAAC;IACJ,CAAC,MAAM;MACLR,SAAS,CAACK,QAAQ,CAAC,WAAW,EAAE;QAC9BC,GAAG,EAAEL,KAAK,CAACM,OAAO;QAClB,MAAM,EAAEN,KAAK,CAACU,GAAG;QACjBH,OAAO,EAAEP,KAAK,CAACO;MACjB,CAAC,CAAC;IACJ;EACF;EAEAI,SAASA,CAACC,IAAI,EAAE;IACd,IAAIA,IAAI,CAACC,IAAI,KAAK,WAAW,EAAE;MAC7B,IAAI,CAACb,KAAK,GAAG;QACXM,OAAO,EAAEM,IAAI,CAACE,UAAU,CAACT,GAAG;QAC5BK,GAAG,EAAEE,IAAI,CAACE,UAAU,CAAC,MAAM,CAAC;QAC5BP,OAAO,EAAEK,IAAI,CAACE,UAAU,CAACP;MAC3B,CAAC;;MAED;MACA,IAAIK,IAAI,CAACE,UAAU,CAACN,QAAQ,EAAE;QAC5B,IAAI,CAACR,KAAK,CAACE,MAAM,GAAGU,IAAI,CAACE,UAAU,CAACN,QAAQ;MAC9C;MACA,OAAO,IAAI;IACb;IACA,OAAO,KAAK;EACd;EAEAO,SAASA,CAAA,EAAG,CAAC;EAEbC,UAAUA,CAAA,EAAG;IACX,OAAO,KAAK;EACd;;EAEA;AACF;AACA;AACA;EACEf,cAAcA,CAACD,KAAK,EAAE;IACpB;IACA;;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,OAAOA,KAAK,CAACE,MAAM,IAAIF,KAAK,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,GAAG;EACzD;AACF;AAEAc,MAAM,CAACC,OAAO,GAAGtB,cAAc"}